(()=>{"use strict";const e=250,t=.5;function a(e){"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",e):e())}function c(a){let c;const n=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting?c||(c=setTimeout((()=>{a(),n.unobserve(t.target)}),e||0)):c&&(clearTimeout(c),c=!1)}))}),{threshold:t});return n}function n(e,t="submit"){if(e){const a=newspack_recaptcha_data?.site_key;return grecaptcha.execute(a,{action:t}).then((t=>{e.value=t}))}}function r(e){const t=parseInt(e.getAttribute("data-recaptcha-widget-id"));isNaN(t)||grecaptcha.reset(t)}window.newspack_grecaptcha=window.newspack_grecaptcha||{destroy:function(e=[]){(e.length?e:[...document.querySelectorAll("form[data-newspack-recaptcha]")]).forEach((e=>{!function(e){const t=e.querySelector('input[name="g-recaptcha-response"]');t&&t.parentElement.removeChild(t)}(e)}))},render:p,version:newspack_recaptcha_data.version};const o="v2"===newspack_recaptcha_data.version.substring(0,2),i="v3"===newspack_recaptcha_data.version,s=newspack_recaptcha_data.site_key,d="v2_invisible"===newspack_recaptcha_data.version;function u(e,t=null,a=null){const n={sitekey:s,size:d?"invisible":"normal",isolated:!0};[...e.querySelectorAll('input[type="submit"], button[type="submit"]')].forEach((o=>{if(o.hasAttribute("data-skip-recaptcha"))return;const i=a=>{t?.();let c=e.querySelector('[name="g-recaptcha-response"]');c||(c=document.createElement("input"),c.type="hidden",c.name="g-recaptcha-response",e.appendChild(c)),c.value=a,e.requestSubmit(o),r(o)},s=()=>{const t=parseInt(o.getAttribute("data-recaptcha-retry-count"))||0;if(t<3)r(o),grecaptcha.execute(o.getAttribute("data-recaptcha-widget-id")),o.setAttribute("data-recaptcha-retry-count",t+1);else{const t=wp.i18n.__("There was an error connecting with reCAPTCHA. Please reload the page and try again.","newspack-plugin");a?a(t):function(e,t){const a=document.createElement("p");a.textContent=t;const c=document.createElement("div");c.classList.add("newspack-recaptcha-error"),c.appendChild(a),e.parentElement.classList.contains("newspack-newsletters-subscribe")?e.append(c):(c.classList.add("newspack-ui__notice","newspack-ui__notice--error"),e.insertBefore(c,e.firstChild))}(e,t)}},d=()=>{c((()=>u(e,t,a))).observe(e,{attributes:!0}),o.addEventListener("click",(t=>{t.preventDefault(),t.stopImmediatePropagation(),function(e){const t=e.querySelectorAll(".newspack-recaptcha-error");for(const e of t)e.parentElement.removeChild(e)}(e),o.hasAttribute("data-skip-recaptcha")?i():grecaptcha.execute(l).then((()=>{window?.location!==window?.parent?.location&&document.body.scrollIntoView({behavior:"smooth"})}))}))};if(jQuery&&(jQuery(document).on("updated_checkout",(()=>d)),jQuery(document.body).on("checkout_error",(()=>d))),o.hasAttribute("data-recaptcha-widget-id"))return void r(o);const p=document.createElement("div");p.classList.add("grecaptcha-container"),document.body.append(p);const l=grecaptcha.render(p,{...n,callback:i,"error-callback":s,"expired-callback":s});o.setAttribute("data-recaptcha-widget-id",l),d()}))}function p(e=[],t=null,r=null){if(!grecaptcha)return a((()=>grecaptcha.ready((()=>p(e,t,r)))));(e.length?e:[...document.querySelectorAll("form[data-newspack-recaptcha]")]).forEach((e=>{c((()=>{o&&u(e,t,r),i&&function(e){let t=e.querySelector('input[name="g-recaptcha-response"]');if(!t){t=document.createElement("input"),t.type="hidden",t.name="g-recaptcha-response",e.appendChild(t);const a=e.getAttribute("data-newspack-recaptcha")||"submit";n(t,a),setInterval((()=>n(t,a)),3e4),jQuery&&(jQuery(document).on("updated_checkout",(()=>n(t,a))),jQuery(document.body).on("checkout_error",(()=>n(t,a))))}}(e)})).observe(e,{attributes:!0})}))}a((function(){grecaptcha.ready(p)}))})();